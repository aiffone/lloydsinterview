steps:
  # Step 1: Set up GKE authentication for the region.
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'  # Use the cloud-sdk image
    entrypoint: 'sh'
    args:
      - '-c'
      - |
        echo "Authenticating with GKE in the region..."
        gcloud container clusters get-credentials infra1-gke-cluster --region us-central1 --project $PROJECT_ID

  # Step 2: Install Docker and Docker Compose.
  - name: 'gcr.io/cloud-builders/docker'
    entrypoint: 'sh'
    args:
      - '-c'
      - |
        echo "Installing Docker Compose..."
        apt-get update && apt-get install -y docker-compose

  # Step 3: Build and run Jenkins using Docker Compose.
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'compose'
      - 'up'
      - '-d'  # Run in detached mode

  # Step 4: Wait for Jenkins to be up and running (optional).
  - name: 'gcr.io/cloud-builders/docker'
    entrypoint: 'sh'
    args:
      - '-c'
      - |
        echo "Waiting for Jenkins to start..."
        sleep 60  # Adjust the sleep time if necessary

# Optional: Set the service account if necessary for specific permissions.
serviceAccount: "514264950628-compute@developer.gserviceaccount.com"

# Specify logs bucket for Cloud Build logs.
logsBucket: "gs://cloudbuild-logs-0111"  # Replace with your actual bucket name.
